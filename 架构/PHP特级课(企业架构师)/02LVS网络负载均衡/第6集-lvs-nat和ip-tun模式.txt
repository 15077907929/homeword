网络负载均衡
	1.基于网络设备的负载均衡
	2.基于操作系统的负载均衡
		cisco的以太网通道
			pc-a--------			-------					------------pc-c
						|-----交换机-------交换机-----------|
			pc-b--------			-------					------------pc-d
									以太网通道		交换机的口可以叫以太网口	多根线叫以太网通道	可以分担流量	多车道
				平分数据
		f5负载均衡图	轮循	nat	网络地址转换	认为把网络地址改掉	dnat	目的地址转换
			207.17.117.20
				internet	src:207.17.117.20:4003	dest:216.34.94.17:80
				216.34.94.17:80	big-ip translates dest address to node based on load balancing
				|			|					|						|	src:207.17.117.20:4003	dest:192.168.20.4:8080
		192.168.20.1:80	192.168.20.2:4002	192.168.20.3:80	192.168.20.4:8080	src:207.17.117.20:4003	dest:192.168.20.3:80
	f5负载均衡原理
		1.客户发出服务请求到vip
		2.bigip接收到请求，将数据包中的目的ip地址改为选中的后台服务器ip地址，然后将数据包发出到后台选定的服务器
		3.后台服务器收到后，将应答包按照其路由发回到bigip
		4.bigip接收到应答包后将其中的源地址改回成vip的地址，发回客户端，由此完成了一个标准的服务器负载均衡的流程。
	一次完整的刷新，tcp 3次链接4次断开
lvs模式
	lvs常用的三种负载均衡模式：
		1.lvs nat模式
		2.lvs ip-tun模式
		3.lvs dr模式
lvs nat模式
	1)virtual server via network address translation(vs/nat)
		通过网络地址转换，调度器重写请求报文中的目标地址，根据预设的调度算法，将请求分派给后端的真实服务器；
		真实服务器的响应报文通过调度器时，报文的源地址被重写，再返回给客户，完成整个负载调度过程。
			lvs nat模式拓扑
				这里做的实验采用基于vs/nat，轮叫机制
						  eth0:8.8.8.8									|--------web server:192.168.10.2
			internet------------------lvs----------------------交换机----	
										 eth1:192.168.10.1				|--------web server:192.168.10.3
				这里lvs要打通路由管道，linux服务器是一个路由器，连接两个不同网段
				私网ip不能出现在公网
					私网ip：192.168.*.*、172.16.*.*、10.*.*.*	
			优点：私有ip不要花钱，内外分离，安全
			不足：lvs可能会成为瓶颈(一般不会形成瓶颈，路由管道很快的，很难形成瓶颈，只是预设)
ip tun模式
	2)virtual server via ip tunneling(vs/tun)
		采用nat技术时，由于请求和响应报文都必须经过调度器地址重写，当客户的请求越来越多时，调度器的处理能力将成为瓶颈。
		为了解决这个问题，调度器把请求报文通过ip隧道转发至真实服务器，而真实服务器将响应直接返回给客户，所以调度器只
		处理请求报文。由于一般网路服务应答请求比请求报文大许多，采用vs/tun技术后，集群系统的最大吞吐量可以提高10倍。
			需要有隧道网卡(lvs、web server)，有的老机器没有隧道网卡
						eth0:192.168.10.10								|--------web server:192.168.10.2
			internet------------------lvs----------------------交换机----	
				(1)向vip发出请求		 eth1:192.168.10.1	(2)隧道封装	|--------web server:192.168.10.3				
											(3)请求返回给客户
			一块网卡上可以配置多个ip	
			缺点：ip需要都是公网ip
			优点：上行数据量少，下行数据量多，回去的数据多，不走lvs，不会造成瓶颈
lvs ip-tun实验规划
	lvs脚本
	directorserver 192.168.10.1	lvs服务器
	realserver 192.168.10.2
	realserver 192.168.10.3
	vip=192.168.10.10	
lvs ip-tun服务器脚本
	ifconfig tunl0 192.168.10.10 netmask 255.255.255.255 up			tunl0:隧道网卡	4个255代表这个网络里面只有它一个
																	子网掩码和ip地址的余运算就是网段
																	余运算1和1得1其余全是0
																	只有在一个网段才可以互相通信
																	2.2.2.1		255.255.255.0	2.2.2.0	
																	2.2.2.2		255.255.255.0	2.2.2.0
																	2.2.2.3		255.255.255.255		2.2.2.3
																	不属于同一个网段，在网络中是很严重的
																	子网掩码的作用，决定网段
	route add -host 192.168.10.10 dev tunl0		给lvs加一个路由表，人为的	计算机可能误认为192.168.10.10是192.168.10.0网段的	
	ipvsadm -C		清除历史记录
	ipvsadm -A -t 192.168.10.10:80 -s rr		rr模式：轮叫模式
	ipvsadm -a -t 192.168.10.10:80 -r 192.168.10.2 -i	-r：real
	ipvsadm -a -t 192.168.10.10:80 -r 192.168.10.3 -i
	ipvsadm
	一台计算机的不同的网卡，绝对不能配置到一个网段，因为计算机同时时路由器，路由器不允许它的接口处于同一个网段
lvs ip-tun真实客户端脚本
	ifconfig tunl0 192.168.10.10 netmask 255.255.255.255 up
	route add -host 192.168.10.10 dev tunl0
	echo "1" > /proc/sys/net/ipv4/conf/tunl0/arp_ignore
	echo "2" > /proc/sys/net/ipv4/conf/tunl0/arp_announce
	echo "1" > /proc/sys/net/ipv4/conf/all/arp_ignore
	echo "2" > /proc/sys/net/ipv4/conf/all/arp_announce
	隧道没有mac地址
lvs dr模式
3)virtual server via direct routing(vs/dr)
	vs/dr通过改写请求报文的mac地址，将请求发送到真实服务器，而真实服务器将响应直接返回给客户。同vs/tun技术一样，
	vs/dr技术可极大地提高集群系统的伸缩性。这种方法没有ip隧道的开销，对集群中的真实服务器也没有必须支持ip隧道协议
	的要求，但是要求调度器与真实服务器都有一块网卡连在同一物理网段上。
	
	
				
				
				
				